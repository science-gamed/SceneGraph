(function(t){var e,i={};(function(t){"use strict";e=function(t){this.canvas=t,this.ctx=t.getContext("2d"),this.buffer=document.createElement("canvas"),this.bufferCtx=this.buffer.getContext("2d"),this.width=this.buffer.width=t.width,this.height=this.buffer.height=t.height,this._opacity=1,this.layers=[]},e.prototype={vw:function(t){return.01*t*this.width},vh:function(t){return.01*t*this.height},opacity:function(t){return arguments.length?(this._opacity=this.ctx.globalAlpha=t,this.dirty=!0,void 0):this._opacity},render:function(){var t,e,i,n;for(t=this.layers.length,i=0;t>i;i+=1)if(this.layers[i].dirty){n=!0;break}if(n)for(this.bufferCtx.clearRect(0,0,this.width,this.height),i=0;t>i;i+=1)e=this.layers[i],e.render(),this.bufferCtx.drawImage(e.canvas,0,0);this.dirty&&(this.ctx.clearRect(0,0,this.width,this.height),this.ctx.drawImage(this.buffer,0,0),this.dirty=!1)},setSize:function(t,e){var i;for(this.width=this.buffer.width=this.canvas.width=t,this.height=this.buffer.height=this.canvas.height=e,i=this.layers.length;i--;)this.layers[i].setSize(t,e)},empty:function(){this.layers=[],this.ctx.clearRect(0,0,this.width,this.height)},layer:function(){var e=new t.Layer(this);return this.layers[this.layers.length]=e,e}}})(i),function(t,e){"use strict";t.defineShape=function(t,i){var n=e.Shape.extend(i);e.Group.prototype[t]=function(t){var e;return t=t||{},t.scene=this.scene,t.layer=this.layer,t.parent=this,e=new n(t),this.children[this.children.length]=e,this.length=this.children.length,this.layer.dirty=!0,e},e.Layer.prototype[t]=function(){return this.root[t].apply(this.root,arguments)}}}(e,i),function(t){"use strict";t.Layer=function(e){this.scene=e,this.canvas=document.createElement("canvas"),this.canvas.width=e.width,this.canvas.height=e.height,this.ctx=this.canvas.getContext("2d"),this.CTM=new t.Matrix,this.root=new t.Group({scene:e,layer:this,parent:this})},t.Layer.prototype={setSize:function(t,e){this.width=this.canvas.width=t,this.height=this.canvas.height=e},render:function(){this.dirty&&(this.ctx.clearRect(0,0,this.width,this.height),this.root.render(this.ctx),this.dirty=!1,this.scene.dirty=!0)}}}(i),function(t){"use strict";var e;e=["strokeStyle","fillStyle","lineWidth","lineCap","lineJoin","miterLimit","shadowOffsetX","shadowOffsetY","shadowBlur","shadowColor","globalCompositeOperation"],t.modifyCtxState=function(t,i){var n;e.forEach(function(e){i.hasOwnProperty(e)&&(t[e]=i[e])}),i.hasOwnProperty("opacity")&&(t.globalAlpha=i.opacity),n=i.LTM,t.transform(n.a,n.b,n.c,n.d,n.e,n.f)}}(i),function(t){"use strict";t.Matrix=function(t,e,i,n,s,r){"object"==typeof t&&6===t.length?this.elements=t:void 0!==t?this.elements=[t,e,i,n,s,r]:this.reset()},t.Matrix.prototype={apply:function(t,e,i){return void 0!==t&&t.length&&(e=t[1],t=t[0]),i=i||7,[this.elements[0]*t+this.elements[2]*e+this.elements[4],this.elements[1]*t+this.elements[3]*e+this.elements[5]]},multiply:function(e){var i=this.elements,n=e instanceof t.Matrix?e.elements:arguments,s=new t.Matrix,r=i[0],h=n[0],a=i[1],o=n[1],c=i[2],l=n[2],u=i[3],f=n[3],p=i[4],d=n[4],y=i[5],m=n[5];return s.elements=[r*h+c*o,a*h+u*o,r*l+c*f,a*l+u*f,r*d+c*m+p,a*d+u*m+y],s},translate:function(t,e){return this.multiply(1,0,0,1,t,e)},translateX:function(t){return this.multiply(1,0,0,1,t,0)},translateY:function(t){return this.multiply(1,0,0,1,0,t)},scale:function(t,e,i,n){var s;return e=e||t,s=void 0!==i?this.translate(-i,-n).scale(t,e).translate(i,n):this.multiply(t,0,0,e,0,0)},scaleX:function(t){return this.multiply(t,0,0,1,0,0)},scaleY:function(t){return this.multiply(1,0,0,t,0,0)},rotate:function(t,e,i){var n;return n=void 0!==e?this.translate(-e,-i).rotate(t).translate(e,i):this.rotateRad(.01745329251994*t)},rotateRad:function(t){var e=Math.cos(t),i=Math.sin(t);return this.multiply(e,i,-i,e,0,0)},flipX:function(){return this.scale(-1,1)},flipY:function(){return this.scale(1,-1)},skewX:function(t){return this.skewXRad(.01745329251994*t)},skewY:function(t){return this.skewYRad(.01745329251994*t)},skewXRad:function(t){return this.multiply(1,0,Math.tan(t),1,0,0)},skewYRad:function(t){return this.multiply(1,Math.tan(t),0,1,0,0)},decompose:function(){return this.decomposed=t.Matrix.decompose(this),this.decomposed},clone:function(){var e=this.elements;return new t.Matrix(e[0],e[1],e[2],e[3],e[4],e[5])},inverse:function(){var t,e=this.elements,i=new n.Matrix,n=i.elements;return t=e[0]*e[3]-e[2]*e[1],n[0]=e[3]/t,n[1]=-e[1]/t,n[2]=-e[2]/t,n[3]=e[0]/t,n[4]=(e[2]*e[5]-e[4]*e[3])/t,n[5]=(e[4]*e[1]-e[0]*e[5])/t,i},set:function(t,e,i,n,s,r){return this.elements=[t,e,i,n,s,r],this.decomposed={},this},reset:function(){return this.elements=[1,0,0,1,0,0],this.decomposed={rotate:0,scaleX:1,scaleY:1,shear:0,translateX:0,translateY:0},this},equals:function(t,e,i,n,s,r,h){var a,o,c,l,u=!0;for(t instanceof l.Matrix?(a=t.elements,h=e||1e-7):(a=[t,e,i,n,s,r],h=h||1e-7),l=0;6>l;l+=1)o=this.elements[l],c=a[l],(o>c+h||c-h>o)&&(u=!1);return u},toString:function(){return"matrix("+this.elements.join(",")+")"}},t.Matrix.fromString=function(e){for(var i,n,s,r=["translate","translateX","translateY","scale","scaleX","scaleY","rotate","skewX","skewY","matrix"],h=RegExp("("+r.join("|")+")\\(([^\\)]+)\\)","gi"),a=function(t){var e,i,n,s,r,h=t.split(","),a=[],o=180/Math.PI,c=200/Math.PI,l=360,u=/grad|rad|deg|turn/;for(e=0;h.length>e;e+=1)if(i=h[e].replace("px",""),r=u.exec(i)){switch(s=+i.replace(u,""),n=r[0],n.toLowerCase()){case"rad":s*=o;break;case"grad":s*=c;break;case"turn":s*=l}a[a.length]=s}else a[a.length]=+i;return a},o=new t.Matrix;i=h.exec(e);)n=i[1].toLowerCase().replace("x","X").replace("y","Y").replace("iX","ix"),s=a(i[2]),"matrix"===n?o.multiply.apply(o,s):o[n].apply(o,s);return o},t.Matrix.decompose=function(e,i,n,s,r,h){var a,o,c,l,u,f,p,d,y,m,g={};return e instanceof t.Matrix&&(a=e.elements,e=a[0],i=a[1],n=a[2],s=a[3],r=a[4],h=a[5]),0===e*s-i*n?!1:(g.translateX=r,g.translateY=h,p=function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])},g.scaleX=o=p([e,i]),e/=o,i/=o,d=function(t,e){return t[0]*e[0]+t[1]*e[1]},c=d([e,i],[n,s]),m=function(t,e){return[t[0]+e[0],t[1]+e[1]]},y=function(t,e){return[t[0]*e,t[1]*e]},l=m(y([e,i],-c),[n,s]),g.scaleY=p([l[0],l[1]]),g.shear=c/g.scaleY,u=e,f=i,g.rotate=f>=0?Math.acos(u):2*Math.PI-Math.acos(u),g.rotationRads=g.rotate,g.rotationDegs=g.rotationRads*(180/Math.PI),g)}}(i),function(t){"use strict";t.Shape=function(e){var i;for(i in e)e.hasOwnProperty(i)&&(this[i]=e[i]);this.LTM?this.CTM=e.parent.CTM.multiply(this.LTM):(this.LTM=new t.Matrix,this.CTM=this.parent.CTM.clone())},t.Shape.prototype={set:function(t,e){this[t]=e,this.layer.dirty=!0},scale:function(t){this.LTM=this.LTM.scale(t),this.updateCTM()},rotate:function(t){this.LTM=this.LTM.rotate(t),this.updateCTM()},updateCTM:function(){this.CTM=this.parent.CTM.multiply(this.LTM)}},t.Shape.extend=function(e){var i,n,s;i=this,n=function(){this._super=i.prototype,t.Shape.apply(this,arguments),this.init&&this.init.apply(this,arguments)};for(s in i.prototype)i.prototype.hasOwnProperty(s)&&(n.prototype[s]=i.prototype[s]);for(s in e)e.hasOwnProperty(s)&&(n.prototype[s]=e[s]);return n.extend=i.extend,n}}(i),function(t){"use strict";t.Group=t.Shape.extend({init:function(){this.children=[],this.length=0},render:function(e){var i,n;for(e.save(),t.modifyCtxState(e,this),i=0;this.length>i;i+=1)n=this.children[i],e.save(),t.modifyCtxState(e,n),n.render(e),e.restore();e.restore()},updateCTM:function(){var t;for(this.CTM=this.parent.CTM.multiply(this.LTM),t=this.length;t--;)this.children[t].updateCTM()}})}(i),function(t){"use strict";t.defineShape("rect",{render:function(t){t.fillRect(this.x,this.y,this.width,this.height),t.strokeRect(this.x,this.y,this.width,this.height)}})}(e),function(t){"use strict";t.defineShape("image",{render:function(t){t.drawImage(this.image,this.x,this.y,this.width,this.height)}})}(e),function(t){"use strict";t.defineShape("text",{render:function(t){t.font=this.fontSize+"px "+this.fontFace,t.textAlign=this.align||"start",t.textBaseline=this.baseline||"alphabetic",t.fillText(this.content,this.x,this.y),t.stroke()}})}(e),function(t){"use strict";var e=2*Math.PI;t.defineShape("circle",{render:function(t){t.beginPath(),t.arc(this.x,this.y,this.r,0,e),t.fill(),t.stroke()}})}(e),t.module!==void 0&&t.module.exports?t.module.exports=e:t.define!==void 0&&t.define.amd?t.define(function(){return e}):t.SceneGraph=e})(this);